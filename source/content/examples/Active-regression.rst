Active regression
=================

In this example, we are going to demonstrate how can the ActiveLearner be used for active regression using Gaussian processes. Since Gaussian processes provide a way to quantify uncertainty of the predictions as the covariance function of the process, they can be used in an active learning setting.

The executable script for this example can be `found here! <https://github.com/cosmic-cortex/modAL/blob/master/examples/active_regression.py>`__

The dataset
-----------

For this example, we shall try to learn the *noisy sine* function:

.. code:: python

    import numpy as np

    X = np.random.choice(np.linspace(0, 20, 10000), size=200, replace=False).reshape(-1, 1)
    y = np.sin(X) + np.random.normal(scale=0.3, size=X.shape)

Uncertainty measure and query strategy for Gaussian processes
-------------------------------------------------------------

For active learning, we shall define a custom query strategy tailored to Gaussian processes. More information on how to write your custom query strategies can be found at the page `Extending modAL <../overview/Extending-modAL.html>`__. In a nutshell, a *query stategy* in modAL is a function taking (at least) two arguments (an estimator object and a pool of examples), outputting the index of the queried instance and the instance itself. In our case, the arguments are ``regressor`` and ``X``.

.. code:: python

    def GP_regression_std(regressor, X):
        _, std = regressor.predict(X, return_std=True)
        query_idx = np.argmax(std)
        return query_idx, X[query_idx]

Active learning
---------------

Initializing the active learner is as simple as always.

.. code:: python

    from modAL.models import ActiveLearner
    from sklearn.gaussian_process import GaussianProcessRegressor
    from sklearn.gaussian_process.kernels import WhiteKernel, RBF

    n_initial = 5
    initial_idx = np.random.choice(range(len(X)), size=n_initial, replace=False)
    X_training, y_training = X[initial_idx], y[initial_idx]

    kernel = RBF(length_scale=1.0, length_scale_bounds=(1e-2, 1e3)) \
             + WhiteKernel(noise_level=1, noise_level_bounds=(1e-10, 1e+1))

    regressor = ActiveLearner(
        estimator=GaussianProcessRegressor(kernel=kernel),
        query_strategy=GP_regression_std,
        X_training=X_training.reshape(-1, 1), y_training=y_training.reshape(-1, 1)
    )

The initial regressor is not very accurate.

.. figure:: img/gp-initial.png
   :align: center

The blue band enveloping the regressor represents the standard deviation of the Gaussian process at the given point. Now we are ready to do active learning!

.. code:: python

    # active learning
    n_queries = 10
    for idx in range(n_queries):
        query_idx, query_instance = regressor.query(X)
        regressor.teach(X[query_idx].reshape(1, -1), y[query_idx].reshape(1, -1))

After active learning, we can see that the prediction is much improved.

.. figure:: img/gp-final.png
   :align: center
