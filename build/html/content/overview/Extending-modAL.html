

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extending modAL &mdash; modAL  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ActiveLearner" href="../models/ActiveLearner.html" />
    <link rel="prev" title="Installation" href="Installation.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/modAL_b.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="modAL-in-a-nutshell.html">modAL in a nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extending modAL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#building-blocks-of-query-strategies">Building blocks of query strategies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#utility-measures">Utility measures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linear-combinations-and-products">Linear combinations and products</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selectors">Selectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-them-together">Putting them together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-your-custom-estimators">Using your custom estimators</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/ActiveLearner.html">ActiveLearner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/BayesianOptimizer.html">BayesianOptimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/Committee.html">Committee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/CommitteeRegressor.html">CommitteeRegressor</a></li>
</ul>
<p class="caption"><span class="caption-text">Query strategies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../query_strategies/Acquisition-functions.html">Acquisition functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query_strategies/Uncertainty-sampling.html">Uncertainty sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query_strategies/Disagreement-sampling.html">Disagreement sampling</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/Pool-based-sampling.html">Pool-based sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Stream-based-sampling.html">Stream-based sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Active-regression.html">Active regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Ensemble-regression.html">Ensemble regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Bayesian-optimization.html">Bayesian optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Query-by-committee.html">Query by committee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Bootstrapping-and-bagging.html">Bootstrapping and bagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Keras-integration.html">Keras integration</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">modAL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Extending modAL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/content/overview/Extending-modAL.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extending-modal">
<h1>Extending modAL<a class="headerlink" href="#extending-modal" title="Permalink to this headline">¶</a></h1>
<p>modAL was designed for researchers, allowing quick and efficient
prototyping. For this purpose, modAL makes it easy for you to use your
customly designed parts, for instance query strategies or new classifier
algorithms.</p>
<div class="section" id="building-blocks-of-query-strategies">
<h2>Building blocks of query strategies<a class="headerlink" href="#building-blocks-of-query-strategies" title="Permalink to this headline">¶</a></h2>
<p>In modAL, a query strategy for active learning is implemented as a
function, taking an estimator and a bunch of data, turning it into an
instance from the data you supplied to it. To build elaborate custom
query strategies, many building blocks are available. The two main
components of a query strategy are the utility measure and the query
selector. From an abstract viewpoint, this is how a query strategy looks
like.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_query_strategy</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">a_keyword_argument</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
    <span class="c1"># measure the utility of each instance in the pool</span>
    <span class="n">utility</span> <span class="o">=</span> <span class="n">utility_measure</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

    <span class="c1"># select the indices of the instances to be queried</span>
    <span class="n">query_idx</span> <span class="o">=</span> <span class="n">select_instances</span><span class="p">(</span><span class="n">utility</span><span class="p">)</span>

    <span class="c1"># return the indices and the instances</span>
    <span class="k">return</span> <span class="n">query_idx</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">query_idx</span><span class="p">]</span>
</pre></div>
</div>
<p>Putting this to work is as simple as the following.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modAL.models</span> <span class="k">import</span> <span class="n">ActiveLearner</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>

<span class="c1"># initializing the learner</span>
<span class="n">learner</span> <span class="o">=</span> <span class="n">ActiveLearner</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(),</span>
    <span class="n">query_strategy</span><span class="o">=</span><span class="n">custom_query_strategy</span>
<span class="p">)</span>

<span class="c1"># querying for labels</span>
<span class="n">query_idx</span><span class="p">,</span> <span class="n">query_instance</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>For an example in practice, see for instance this <a class="reference external" href="../examples/Active-regression.html">active
regression</a>. In the following, we are going to
take a look how can you combine already existing or custom utility
measures with each other.</p>
<div class="section" id="utility-measures">
<h3>Utility measures<a class="headerlink" href="#utility-measures" title="Permalink to this headline">¶</a></h3>
<p>The soul of a query strategy is the utility measure. A utility measure
takes a pool of examples (and frequently but optionally an estimator
object) and returns a one dimensional array containing the utility score
for each example. For instance, <code class="docutils literal notranslate"><span class="pre">classifier_uncertainty</span></code>,
<code class="docutils literal notranslate"><span class="pre">classifier_margin</span></code> and <code class="docutils literal notranslate"><span class="pre">classifier_entropy</span></code> from
<code class="docutils literal notranslate"><span class="pre">modAL.uncertainty</span></code> are utility measures which you can use. You can
also implement your own or you can take linear combinations and
products, as we shall see next.</p>
</div>
<div class="section" id="linear-combinations-and-products">
<h3>Linear combinations and products<a class="headerlink" href="#linear-combinations-and-products" title="Permalink to this headline">¶</a></h3>
<p>One way of creating new utility measures is to take linear combinations
or products of already existing ones. For this, the function factories
in the module <code class="docutils literal notranslate"><span class="pre">modAL.utils.combination</span></code> are there to help!</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modAL.utils.combination</span> <span class="k">import</span> <span class="n">make_linear_combination</span><span class="p">,</span> <span class="n">make_product</span>
<span class="kn">from</span> <span class="nn">modAL.uncertainty</span> <span class="k">import</span> <span class="n">classifier_uncertainty</span><span class="p">,</span> <span class="n">classifier_margin</span>

<span class="c1"># creating new utility measures by linear combination and product</span>
<span class="c1"># linear_combination will return 1.0*classifier_uncertainty + 1.0*classifier_margin</span>
<span class="n">linear_combination</span> <span class="o">=</span> <span class="n">make_linear_combination</span><span class="p">(</span>
    <span class="n">classifier_uncertainty</span><span class="p">,</span> <span class="n">classifier_margin</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># product will return (classifier_uncertainty**0.5)*(classifier_margin**0.1)</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">make_product</span><span class="p">(</span>
    <span class="n">classifier_uncertainty</span><span class="p">,</span> <span class="n">classifier_margin</span><span class="p">,</span>
    <span class="n">exponents</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">make_linear_combination</span></code> and <code class="docutils literal notranslate"><span class="pre">make_product</span></code>, you must supply
functions taking the same arguments!</p>
<p>The newly generated utility measures are demonstrated in the following
figure.</p>
<img alt="../../_images/em-combinations.png" class="align-center" src="../../_images/em-combinations.png" />
</div>
<div class="section" id="selectors">
<h3>Selectors<a class="headerlink" href="#selectors" title="Permalink to this headline">¶</a></h3>
<p>After the individual utility scores are calculated, a query strategy
must determine which instances are to be queried. Two prebuilt selectors
are available in <code class="docutils literal notranslate"><span class="pre">modAL.utils.selection</span></code>:
<code class="docutils literal notranslate"><span class="pre">multi_argmax(values,</span> <span class="pre">n_instances=1)</span></code> selects the <code class="docutils literal notranslate"><span class="pre">n_instances</span></code>
highest utility score, while <code class="docutils literal notranslate"><span class="pre">weighted_random(weights,</span> <span class="pre">n_instances=1)</span></code>
selects the instances by random, using the supplied weighting.</p>
</div>
<div class="section" id="putting-them-together">
<h3>Putting them together<a class="headerlink" href="#putting-them-together" title="Permalink to this headline">¶</a></h3>
<p>When the components are given, putting the query strategy together is
really simple.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_query_strategy</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">n_instances</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">utility</span> <span class="o">=</span> <span class="n">linear_combination</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">query_idx</span> <span class="o">=</span> <span class="n">multi_argmax</span><span class="p">(</span><span class="n">utility</span><span class="p">,</span> <span class="n">n_instances</span><span class="o">=</span><span class="n">n_instances</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query_idx</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">query_idx</span><span class="p">]</span>
</pre></div>
</div>
<p>This can be used immediately in the active learning workflow! If you
would like to experiment with this, you can find the executable script
with this example here.</p>
</div>
</div>
<div class="section" id="using-your-custom-estimators">
<h2>Using your custom estimators<a class="headerlink" href="#using-your-custom-estimators" title="Permalink to this headline">¶</a></h2>
<p>As long as your classifier follows the scikit-learn API, you can use it
in your modAL workflow. (Really, all it needs is a <code class="docutils literal notranslate"><span class="pre">.fit(X,</span> <span class="pre">y)</span></code> and a
<code class="docutils literal notranslate"><span class="pre">.predict(X)</span></code> method.) For instance, the ensemble model implemented in
Committee can be given to an ActiveLearner.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># initializing the learners</span>
<span class="n">n_learners</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">learner_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_learners</span><span class="p">):</span>
    <span class="n">learner</span> <span class="o">=</span> <span class="n">ActiveLearner</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(),</span>
        <span class="n">X_training</span><span class="o">=</span><span class="n">X_training</span><span class="p">,</span> <span class="n">y_training</span><span class="o">=</span><span class="n">y_training</span><span class="p">,</span>
        <span class="n">bootstrap_init</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">learner_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">learner</span><span class="p">)</span>

<span class="c1"># assembling the Committee</span>
<span class="n">committee</span> <span class="o">=</span> <span class="n">Committee</span><span class="p">(</span><span class="n">learner_list</span><span class="p">)</span>

<span class="c1"># ensemble active learner from the Committee</span>
<span class="n">ensemble_learner</span> <span class="o">=</span> <span class="n">ActiveLearner</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">committee</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now you are ready for active learning with an ensemble of classifiers!
If you would like to keep bagging the data pass <code class="docutils literal notranslate"><span class="pre">bootstrap=True</span></code> to
the <code class="docutils literal notranslate"><span class="pre">.teach()</span></code> method!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../models/ActiveLearner.html" class="btn btn-neutral float-right" title="ActiveLearner" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Installation.html" class="btn btn-neutral" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Tivadar Danka

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>