

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bayesian optimization &mdash; modAL  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Query by committee" href="Query-by-committee.html" />
    <link rel="prev" title="Active regression with Committee" href="Ensemble-regression.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/modAL_b.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/modAL-in-a-nutshell.html">modAL in a nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/Extending-modAL.html">Extending modAL</a></li>
</ul>
<p class="caption"><span class="caption-text">Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/ActiveLearner.html">ActiveLearner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/BayesianOptimizer.html">BayesianOptimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/Committee.html">Committee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/CommitteeRegressor.html">CommitteeRegressor</a></li>
</ul>
<p class="caption"><span class="caption-text">Query strategies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../query_strategies/Acquisition-functions.html">Acquisition functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query_strategies/Uncertainty-sampling.html">Uncertainty sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query_strategies/Disagreement-sampling.html">Disagreement sampling</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Pool-based-sampling.html">Pool-based sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Stream-based-sampling.html">Stream-based sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Active-regression.html">Active regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ensemble-regression.html">Ensemble regression</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bayesian optimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-function-to-be-optimized">The function to be optimized</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gaussian-processes">Gaussian processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimizing-using-expected-improvement">Optimizing using <em>expected improvement</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Query-by-committee.html">Query by committee</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bootstrapping-and-bagging.html">Bootstrapping and bagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Keras-integration.html">Keras integration</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">modAL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Bayesian optimization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/content/examples/Bayesian-optimization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bayesian-optimization">
<h1>Bayesian optimization<a class="headerlink" href="#bayesian-optimization" title="Permalink to this headline">¶</a></h1>
<p>When a function is expensive to evaluate, or when gradients are not available, optimalizing it requires more sophisticated methods than gradient descent. One such method is Bayesian optimization, which lies close to active learning. In Bayesian optimization, instead of picking queries by maximizing the uncertainty of predictions, function values are evaluated at points where the promise of finding a better value is large. In modAL, these algorithms are implemented with the <code class="docutils literal notranslate"><span class="pre">BayesianOptimizer</span></code> class, which is a sibling of <code class="docutils literal notranslate"><span class="pre">ActiveLearner</span></code>. In the following example, their use is demonstrated on a toy problem.</p>
<div class="section" id="the-function-to-be-optimized">
<h2>The function to be optimized<a class="headerlink" href="#the-function-to-be-optimized" title="Permalink to this headline">¶</a></h2>
<p>We are going to optimize a simple function to demonstrate the use of <code class="docutils literal notranslate"><span class="pre">BayesianOptimizer</span></code>.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># generating the data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">((</span><span class="mi">10</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div>
</div>
<p>This function looks like the following.</p>
<img alt="../../_images/bo-func.png" class="align-center" src="../../_images/bo-func.png" />
</div>
<div class="section" id="gaussian-processes">
<h2>Gaussian processes<a class="headerlink" href="#gaussian-processes" title="Permalink to this headline">¶</a></h2>
<p>In Bayesian optimization, usually a Gaussian process regressor is used to predict the function to be optimized. One reason is that Gaussian processes can estimate the uncertainty of the prediction at a given point. This in turn can be used to estimate the possible gains at the unknown points.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># assembling initial training set</span>
<span class="n">X_initial</span><span class="p">,</span> <span class="n">y_initial</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">150</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">[</span><span class="mi">150</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># defining the kernel for the Gaussian process</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process</span> <span class="k">import</span> <span class="n">GaussianProcessRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process.kernels</span> <span class="k">import</span> <span class="n">Matern</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">Matern</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">regressor</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="optimizing-using-expected-improvement">
<h2>Optimizing using <em>expected improvement</em><a class="headerlink" href="#optimizing-using-expected-improvement" title="Permalink to this headline">¶</a></h2>
<p>During the optimization, the utility of each point is given by the so-called <em>acquisition function</em>. In this case, we are going to use the <em>expected improvement</em>, which is defined by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
EI(x) = &amp; (\mu(x) - f(x^+) - \xi) \psi\Big( \frac{\mu(x) - f(x^+) - \xi}{\sigma(x)} \Big) \\
&amp; + \sigma(x) \phi\Big( \frac{\mu(x) - f(x^+) - \xi}{\sigma(x)} \Big),
\end{align*}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu(x)\)</span> and <span class="math notranslate nohighlight">\(\sigma(x)\)</span> are the mean and variance of the regressor at <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(f\)</span> is the function to be optimized with estimated maximum at <span class="math notranslate nohighlight">\(x^+\)</span>, <span class="math notranslate nohighlight">\(\xi\)</span> is a parameter controlling the degree of exploration and <span class="math notranslate nohighlight">\(\psi(z)\)</span>, <span class="math notranslate nohighlight">\(\phi(z)\)</span>  denotes the cumulative distribution function and density function of a standard Gaussian distribution. After each query, the acquisition function is reevaluated and the new query is chosen to maximize the acquisition function.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># initializing the optimizer</span>
<span class="kn">from</span> <span class="nn">modAL.models</span> <span class="k">import</span> <span class="n">BayesianOptimizer</span>
<span class="kn">from</span> <span class="nn">modAL.acquisition</span> <span class="k">import</span> <span class="n">max_EI</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">BayesianOptimizer</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">regressor</span><span class="p">,</span>
    <span class="n">X_training</span><span class="o">=</span><span class="n">X_initial</span><span class="p">,</span> <span class="n">y_training</span><span class="o">=</span><span class="n">y_initial</span><span class="p">,</span>
    <span class="n">query_strategy</span><span class="o">=</span><span class="n">max_EI</span>
<span class="p">)</span>

<span class="c1"># Bayesian optimization</span>
<span class="k">for</span> <span class="n">n_query</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">query_idx</span><span class="p">,</span> <span class="n">query_inst</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">teach</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">query_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">[</span><span class="n">query_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Using <em>expected improvement</em>, the first five queries are the following.</p>
<img alt="../../_images/bo-EI.png" class="align-center" src="../../_images/bo-EI.png" />
<p>Of course, there are other acquisition functions out there. The <em>probability of improvement</em> and the <em>upper confidence bound</em> are
presented below for this problem.</p>
<img alt="../../_images/bo-PI.png" class="align-center" src="../../_images/bo-PI.png" />
<img alt="../../_images/bo-UCB.png" class="align-center" src="../../_images/bo-UCB.png" />
<p>If you would like to experiment, check out this <a class="reference external" href="https://github.com/cosmic-cortex/modAL/blob/master/examples/bayesian_optimization.py">runnable example</a> included in modAL! For a tutorial on Bayesian optimization, see <a class="reference external" href="https://arxiv.org/abs/1012.2599">this paper</a>!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Query-by-committee.html" class="btn btn-neutral float-right" title="Query by committee" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Ensemble-regression.html" class="btn btn-neutral" title="Active regression with Committee" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Tivadar Danka

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>